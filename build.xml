<project name="ij-plugins" default="dist" basedir=".">
    <description>
        ij-plugins
    </description>
    
  <!--
    @TODO: Toolkit creation targets.    
    @TODO: PlugIns build file
    @TODO: PlugIns build creation targets
    @TODO: Readme files for the distribution.
    @TODO: Package the binary distribution.
  -->
  
  <!-- Set default properties for this build -->
  <target name="setProps" unless="setProps"
  	description="Setup the propertries">
    <property name="sourceDir" location="." />
    <property name="outputDir" location="output" />
    <property name="distDir"   location="dist"/>
    <property name="ijClasspath" value="${basedir}/lib/ij.jar"/>
    <property name="setProps"  value="true" />
  </target>
  
  <!-- Initialize  -->
  <target name="init" depends="setProps"
  	description="Initialize the properties"> 
    <!-- Create the time stamp -->
    <tstamp/>
    <!-- Create the build directory structure used by compile -->
    <property name="pluginsDir" location="${outputDir}/build/plugins" />
    <property name="classpath" value="${ijClasspath};${pluginsDir}/ij-plugins-toolkit.jar"/>
  </target>

  <target name="prepare" depends="init">
    <mkdir dir="${pluginsDir}/3D IO"/>
    <mkdir dir="${pluginsDir}/3D Toolkit"/>
  </target>
  
  <target name="build" depends="prepare" 
  	description="Build the toolkit and plugin binaries">
    
    <!-- toolkit.jar -->
    <ant dir="./Toolkit" target="package">
      <property name="outputDir" value="${pluginsDir}"/>
      <property name="classpath" value="${ijClasspath}"/>
      <property name="setProps" value="true"/>
    </ant>

    <!-- 3D IO plugins -->
    <ant dir="./Plugins/3D IO" target="compile">
      <property name="outputDir" value="${pluginsDir}/3D IO"/>
      <property name="classpath" value="${classpath}"/>
      <property name="setProps" value="true"/>
    </ant>

    <!-- 3D Toolkit plugins -->
    <ant dir="./Plugins/3D Toolkit" target="compile">
      <property name="outputDir" value="${pluginsDir}/3D Toolkit"/>
      <property name="classpath" value="${classpath}"/>
      <property name="setProps" value="true"/>
    </ant>
  </target>

  <!-- Checkout sources from CVS -->  
  <target name="checkout" depends="init"
          description="Checkout sources drom CVS repository">
          
    <cvs cvsRoot=":pserver:anonymous@cvs.ij-plugins.sourceforge.net:/cvsroot/ij-plugins"
         command="checkout -P"
         package="ij-plugins"
         dest="${outputDir}/source"/>
  </target>

  <target name="distFromCVS" depends="checkout" 
  	description="Build the toolkit and plugin binaries">
    <ant dir="${outputDir}/source/ij-plugins" target="dist">
      <property name="sourceDir" location="${outputDir}/source/ij-plugins" />
      <property name="outputDir"   location="${outputDir}"/>
      <property name="distDir"     location="${distDir}"/>
      <property name="ijClasspath" value="${ijClasspath}"/>
      <property name="setProps"  value="true" />
    </ant>

    <!-- Create source distribution with current day stamp -->
    <zip basedir="${outputDir}/source" 
         destfile="${distDir}/ij-3D-Toolkit_src_${DSTAMP}.zip" />
  </target>
  
  <target name="dist" depends="build"
        description="generate the distribution" >
    <!-- Create the distribution directory -->
    <mkdir dir="${distDir}"/>

    <!-- Create binary distribution with current day stamp -->
    <copy file="${sourceDir}/ReadMe.txt" 
          tofile="${pluginsDir}/ij-3D-Toolkit-ReadMe.txt" 
          overwrite="true"/>
    <zip basedir="${pluginsDir}" 
         destfile="${distDir}/ij-3D-Toolkit_bin_${DSTAMP}.zip" />
  </target>

  <target name="clean" depends="setProps"
        description="clean up" >
    <!-- Delete the ${build} and ${dist} directory trees -->
    <delete dir="${outputDir}" />
  </target>
</project>